<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"><style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(11) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(11) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(11) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(11) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(11) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; }</style><script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Tool Usage Auditing | Model Context Protocol Security</title><meta name="generator" content="Jekyll v3.9.5" /><meta property="og:title" content="Tool Usage Auditing" /><meta property="og:locale" content="en_US" /><meta name="description" content="A Cloud Security Alliance Community Project - Secure Autonomy: Hardening Model-Context-Protocol Servers &amp; Agents" /><meta property="og:description" content="A Cloud Security Alliance Community Project - Secure Autonomy: Hardening Model-Context-Protocol Servers &amp; Agents" /><link rel="canonical" href="http://0.0.0.0:4000/audit/tool-usage-auditing/" /><meta property="og:url" content="http://0.0.0.0:4000/audit/tool-usage-auditing/" /><meta property="og:site_name" content="Model Context Protocol Security" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Tool Usage Auditing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A Cloud Security Alliance Community Project - Secure Autonomy: Hardening Model-Context-Protocol Servers &amp; Agents","headline":"Tool Usage Auditing","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/assets/images/mcp-security-logo.svg"}},"url":"http://0.0.0.0:4000/audit/tool-usage-auditing/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"><div class="site-logo" role="img" aria-label="Model Context Protocol Security"></div></a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Model Context Protocol Security</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Why MCP Security? category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/why/" class="nav-list-link">Why MCP Security?</a><ul class="nav-list"><li class="nav-list-item"><a href="/why/faq.html" class="nav-list-link">FAQ</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in MCP Top 10 Security Risks category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/top10/" class="nav-list-link">MCP Top 10 Security Risks</a><ul class="nav-list"><li class="nav-list-item"><a href="/top10/server/" class="nav-list-link">MCP Server Top 10 Security Risks</a><li class="nav-list-item"><a href="/top10/client/" class="nav-list-link">MCP Client Top 10 Security Risks</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in MCP Security TTPs category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/" class="nav-list-link">MCP Security TTPs</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Prompt Injection & Manipulation category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/prompt-injection/" class="nav-list-link">Prompt Injection & Manipulation</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/prompt-injection/direct-prompt-injection/" class="nav-list-link">Direct Prompt Injection</a><li class="nav-list-item"><a href="/ttps/prompt-injection/indirect-prompt-injection/" class="nav-list-link">Indirect Prompt Injection</a><li class="nav-list-item"><a href="/ttps/prompt-injection/tool-description-poisoning/" class="nav-list-link">Tool Description Poisoning</a><li class="nav-list-item"><a href="/ttps/prompt-injection/context-shadowing/" class="nav-list-link">Context Shadowing</a><li class="nav-list-item"><a href="/ttps/prompt-injection/prompt-state-manipulation/" class="nav-list-link">Prompt-State Manipulation</a><li class="nav-list-item"><a href="/ttps/prompt-injection/ansi-escape-injection/" class="nav-list-link">ANSI Escape Code Injection</a><li class="nav-list-item"><a href="/ttps/prompt-injection/hidden-instructions/" class="nav-list-link">Hidden Instructions</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tool Poisoning & Metadata Attacks category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/tool-poisoning/" class="nav-list-link">Tool Poisoning & Metadata Attacks</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/tool-poisoning/tool-poisoning/" class="nav-list-link">Tool Poisoning</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/tool-mutation/" class="nav-list-link">Tool Mutation/Rug Pull Attacks</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/tool-name-conflict/" class="nav-list-link">Tool Name Conflict</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/tool-shadowing/" class="nav-list-link">Tool Shadowing/Name Collisions</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/preference-manipulation/" class="nav-list-link">Preference Manipulation</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/metadata-prompt-injection/" class="nav-list-link">Prompt Injection in Metadata</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/metadata-manipulation/" class="nav-list-link">Metadata Manipulation</a><li class="nav-list-item"><a href="/ttps/tool-poisoning/tool-impersonation/" class="nav-list-link">Tool Impersonation</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Data Exfiltration & Credential Theft category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/data-exfiltration/" class="nav-list-link">Data Exfiltration & Credential Theft</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/data-exfiltration/data-exfiltration/" class="nav-list-link">Data Exfiltration</a><li class="nav-list-item"><a href="/ttps/data-exfiltration/credential-exfiltration/" class="nav-list-link">Credential Exfiltration</a><li class="nav-list-item"><a href="/ttps/data-exfiltration/token-theft/" class="nav-list-link">Token Theft/Overreach</a><li class="nav-list-item"><a href="/ttps/data-exfiltration/api-key-exposure/" class="nav-list-link">API Key Exposure</a><li class="nav-list-item"><a href="/ttps/data-exfiltration/conversation-history-exfiltration/" class="nav-list-link">Conversation History Exfiltration</a><li class="nav-list-item"><a href="/ttps/data-exfiltration/sensitive-information-disclosure/" class="nav-list-link">Sensitive Information Disclosure</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Command & Code Injection category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/command-injection/" class="nav-list-link">Command & Code Injection</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/command-injection/command-injection/" class="nav-list-link">Command Injection</a><li class="nav-list-item"><a href="/ttps/command-injection/sql-injection/" class="nav-list-link">SQL Injection</a><li class="nav-list-item"><a href="/ttps/command-injection/os-command-injection/" class="nav-list-link">OS Command Injection</a><li class="nav-list-item"><a href="/ttps/command-injection/code-injection/" class="nav-list-link">Code Injection</a><li class="nav-list-item"><a href="/ttps/command-injection/shell-command-execution/" class="nav-list-link">Shell Command Execution</a><li class="nav-list-item"><a href="/ttps/command-injection/output-prompt-injection/" class="nav-list-link">Output Prompt Injection</a><li class="nav-list-item"><a href="/ttps/command-injection/malicious-output-composition/" class="nav-list-link">Malicious Output Composition</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Authentication & Authorization category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/authentication/" class="nav-list-link">Authentication & Authorization</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/authentication/unauthenticated-access/" class="nav-list-link">Unauthenticated Access</a><li class="nav-list-item"><a href="/ttps/authentication/broken-authentication/" class="nav-list-link">Broken Authentication</a><li class="nav-list-item"><a href="/ttps/authentication/authorization-bypass/" class="nav-list-link">Authorization Bypass</a><li class="nav-list-item"><a href="/ttps/authentication/auth-bypass-rogue-server/" class="nav-list-link">Auth Bypass & Rogue Server Registration</a><li class="nav-list-item"><a href="/ttps/authentication/identity-subversion/" class="nav-list-link">Identity Subversion</a><li class="nav-list-item"><a href="/ttps/authentication/session-management-issues/" class="nav-list-link">Session Management Issues</a><li class="nav-list-item"><a href="/ttps/authentication/privilege-escalation/" class="nav-list-link">Privilege Escalation</a><li class="nav-list-item"><a href="/ttps/authentication/audit-bypass/" class="nav-list-link">Audit Bypass</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Supply Chain & Dependencies category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/supply-chain/" class="nav-list-link">Supply Chain & Dependencies</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/supply-chain/malicious-mcp-packages/" class="nav-list-link">Malicious MCP Packages</a><li class="nav-list-item"><a href="/ttps/supply-chain/supply-chain-attacks/" class="nav-list-link">Supply Chain Attacks</a><li class="nav-list-item"><a href="/ttps/supply-chain/dependency-vulnerabilities/" class="nav-list-link">Dependency Vulnerabilities</a><li class="nav-list-item"><a href="/ttps/supply-chain/installer-spoofing/" class="nav-list-link">Installer Spoofing</a><li class="nav-list-item"><a href="/ttps/supply-chain/typosquatting/" class="nav-list-link">Typosquatting</a><li class="nav-list-item"><a href="/ttps/supply-chain/drift-from-upstream/" class="nav-list-link">Drift from Upstream</a><li class="nav-list-item"><a href="/ttps/supply-chain/malicious-dependency-inclusion/" class="nav-list-link">Malicious Dependency Inclusion</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Context Manipulation category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/context-manipulation/" class="nav-list-link">Context Manipulation</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/context-manipulation/context-poisoning/" class="nav-list-link">Context Poisoning</a><li class="nav-list-item"><a href="/ttps/context-manipulation/context-spoofing/" class="nav-list-link">Context Spoofing</a><li class="nav-list-item"> <a href="/ttps/context-manipulation/context-manipulation/" class="nav-list-link"> ∞ </a><li class="nav-list-item"><a href="/ttps/context-manipulation/memory-references-issues/" class="nav-list-link">Memory References Issues</a><li class="nav-list-item"><a href="/ttps/context-manipulation/covert-channel-abuse/" class="nav-list-link">Covert Channel Abuse</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Protocol Vulnerabilities category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/protocol-vulnerabilities/" class="nav-list-link">Protocol Vulnerabilities</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/protocol-vulnerabilities/session-ids-in-urls/" class="nav-list-link">Session IDs in URLs</a><li class="nav-list-item"><a href="/ttps/protocol-vulnerabilities/lack-of-authentication-standards/" class="nav-list-link">Lack of Authentication Standards</a><li class="nav-list-item"><a href="/ttps/protocol-vulnerabilities/missing-integrity-controls/" class="nav-list-link">Missing Integrity Controls</a><li class="nav-list-item"><a href="/ttps/protocol-vulnerabilities/protocol-implementation-flaws/" class="nav-list-link">Protocol Implementation Flaws</a><li class="nav-list-item"><a href="/ttps/protocol-vulnerabilities/insecure-communication/" class="nav-list-link">Insecure Communication</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Privilege & Access Control category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/privilege-access-control/" class="nav-list-link">Privilege & Access Control</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/privilege-access-control/unauthorized-privilege-escalation/" class="nav-list-link">Unauthorized Privilege Escalation</a><li class="nav-list-item"><a href="/ttps/privilege-access-control/excessive-tool-permissions/" class="nav-list-link">Excessive Tool Permissions</a><li class="nav-list-item"><a href="/ttps/privilege-access-control/sandbox-escape/" class="nav-list-link">Sandbox Escape</a><li class="nav-list-item"><a href="/ttps/privilege-access-control/resource-access-control-bypass/" class="nav-list-link">Resource Access Control Bypass</a><li class="nav-list-item"><a href="/ttps/privilege-access-control/cross-context-access/" class="nav-list-link">Cross-Context Access</a><li class="nav-list-item"><a href="/ttps/privilege-access-control/process-injection/" class="nav-list-link">Process Injection</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Economic & Infrastructure Abuse category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/economic-infrastructure-abuse/" class="nav-list-link">Economic & Infrastructure Abuse</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/economic-infrastructure-abuse/resource-exhaustion/" class="nav-list-link">Resource Exhaustion</a><li class="nav-list-item"><a href="/ttps/economic-infrastructure-abuse/api-rate-limit-bypass/" class="nav-list-link">API Rate Limit Bypass</a><li class="nav-list-item"><a href="/ttps/economic-infrastructure-abuse/computational-resource-abuse/" class="nav-list-link">Computational Resource Abuse</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Monitoring & Operational Security category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/monitoring-operational-security/" class="nav-list-link">Monitoring & Operational Security</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/monitoring-operational-security/insufficient-logging/" class="nav-list-link">Insufficient Logging</a><li class="nav-list-item"><a href="/ttps/monitoring-operational-security/missing-audit-trails/" class="nav-list-link">Missing Audit Trails</a><li class="nav-list-item"><a href="/ttps/monitoring-operational-security/inadequate-monitoring/" class="nav-list-link">Inadequate Monitoring</a><li class="nav-list-item"><a href="/ttps/monitoring-operational-security/log-tampering/" class="nav-list-link">Log Tampering</a><li class="nav-list-item"><a href="/ttps/monitoring-operational-security/blind-spots-in-security/" class="nav-list-link">Blind Spots in Security</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in AI-Specific Vulnerabilities category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ttps/ai-specific-vulnerabilities/" class="nav-list-link">AI-Specific Vulnerabilities</a><ul class="nav-list"><li class="nav-list-item"><a href="/ttps/ai-specific-vulnerabilities/model-poisoning/" class="nav-list-link">Model Poisoning</a><li class="nav-list-item"><a href="/ttps/ai-specific-vulnerabilities/inference-attacks/" class="nav-list-link">Inference Attacks</a><li class="nav-list-item"><a href="/ttps/ai-specific-vulnerabilities/model-theft/" class="nav-list-link">Model Theft</a><li class="nav-list-item"><a href="/ttps/ai-specific-vulnerabilities/adversarial-attacks/" class="nav-list-link">Adversarial Attacks</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Hardening Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hardening/" class="nav-list-link">Hardening Guide</a><ul class="nav-list"><li class="nav-list-item"><a href="/hardening/provenance-selection.html" class="nav-list-link">Provenance & Selection</a><li class="nav-list-item"><a href="/hardening/code-integrity-auditing.html" class="nav-list-link">Code Integrity & Auditing</a><li class="nav-list-item"><a href="/hardening/runtime-isolation.html" class="nav-list-link">Runtime Isolation</a><li class="nav-list-item"><a href="/hardening/traffic-mediation.html" class="nav-list-link">Traffic Mediation</a><li class="nav-list-item"><a href="/hardening/secrets-management.html" class="nav-list-link">Secrets Management</a><li class="nav-list-item"><a href="/hardening/observability-logging.html" class="nav-list-link">Observability & Logging</a><li class="nav-list-item"><a href="/hardening/backup-versioning.html" class="nav-list-link">Backup & Versioning</a><li class="nav-list-item"><a href="/hardening/policy-guardrails.html" class="nav-list-link">Policy & Guardrails</a><li class="nav-list-item"><a href="/hardening/payments-wallets.html" class="nav-list-link">Payments & Wallets</a><li class="nav-list-item"><a href="/hardening/lifecycle-management.html" class="nav-list-link">Lifecycle Management</a><li class="nav-list-item"><a href="/hardening/checklist.html" class="nav-list-link">Security Checklist</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Known Vulnerabilities category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/known-vulnerabilities/" class="nav-list-link">Known Vulnerabilities</a><ul class="nav-list"><li class="nav-list-item"><a href="/known-vulnerabilities/cve-2025-49596/" class="nav-list-link">CVE-2025-49596: RCE in MCP Inspector</a><li class="nav-list-item"><a href="/known-vulnerabilities/cve-2025-6514/" class="nav-list-link">CVE-2025-6514: Authentication Bypass and Session Hijacking</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Build Security category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/build/" class="nav-list-link">Build Security</a><ul class="nav-list"><li class="nav-list-item"><a href="/build/oauth-security/" class="nav-list-link">OAuth Security Patterns</a><li class="nav-list-item"><a href="/build/authentication-strategies/" class="nav-list-link">Authentication Strategies</a><li class="nav-list-item"><a href="/build/runtime-isolation/" class="nav-list-link">Runtime Isolation</a><li class="nav-list-item"><a href="/build/architecture-patterns/" class="nav-list-link">Architecture Patterns</a><li class="nav-list-item"><a href="/build/tool-metadata-spec/" class="nav-list-link">Tool Metadata Specification</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Operations Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/operations/" class="nav-list-link">Operations Guide</a><ul class="nav-list"><li class="nav-list-item"><a href="/operations/container-operations.html" class="nav-list-link">Container Operations</a><li class="nav-list-item"><a href="/operations/network-controls.html" class="nav-list-link">Network Controls</a><li class="nav-list-item"><a href="/operations/remote-deployment.html" class="nav-list-link">Remote Deployment</a><li class="nav-list-item"><a href="/operations/monitoring-alerting.html" class="nav-list-link">Monitoring & Alerting</a><li class="nav-list-item"><a href="/operations/incident-response.html" class="nav-list-link">Incident Response</a><li class="nav-list-item"><a href="/operations/api-gateway-operations.html" class="nav-list-link">API Gateway Operations</a><li class="nav-list-item"><a href="/operations/change-management.html" class="nav-list-link">Change Management</a><li class="nav-list-item"><a href="/operations/forensics-investigation.html" class="nav-list-link">Forensics & Investigation</a><li class="nav-list-item"><a href="/operations/operational-maintenance.html" class="nav-list-link">Operational Maintenance</a><li class="nav-list-item"><a href="/operations/operational-runbooks.html" class="nav-list-link">Operational Runbooks</a><li class="nav-list-item"><a href="/operations/performance-security.html" class="nav-list-link">Performance & Security</a><li class="nav-list-item"><a href="/operations/security-troubleshooting.html" class="nav-list-link">Security Troubleshooting</a><li class="nav-list-item"><a href="/operations/security-workflows.html" class="nav-list-link">Security Workflows</a><li class="nav-list-item"><a href="/operations/tls-proxy-management.html" class="nav-list-link">TLS & Proxy Management</a><li class="nav-list-item"><a href="/operations/traffic-redirection.html" class="nav-list-link">Traffic Redirection</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Operational Security category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/operational/" class="nav-list-link">Operational Security</a><ul class="nav-list"><li class="nav-list-item"><a href="/operational/runtime-monitoring/" class="nav-list-link">Runtime Monitoring</a><li class="nav-list-item"><a href="/operational/registry-security/" class="nav-list-link">Registry Security</a><li class="nav-list-item"><a href="/operational/version-management/" class="nav-list-link">Version Management</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference Patterns category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/patterns/" class="nav-list-link">Reference Patterns</a><ul class="nav-list"><li class="nav-list-item"><a href="/patterns/enterprise-gateway.html" class="nav-list-link">Enterprise Gateway</a><li class="nav-list-item"><a href="/patterns/local-dev-container.html" class="nav-list-link">Local Dev Container</a><li class="nav-list-item"><a href="/patterns/llm-heaven-vps.html" class="nav-list-link">LLM Heaven VPS</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Audit Tools category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/audit/" class="nav-list-link">Audit Tools</a><ul class="nav-list"><li class="nav-list-item"><a href="/audit/mcp-inspector.html" class="nav-list-link">MCP Inspector</a><li class="nav-list-item"><a href="/audit/tool-usage-auditing/" class="nav-list-link">Tool Usage Auditing</a><li class="nav-list-item"><a href="/audit/scorecard.html" class="nav-list-link">Selection Scorecard</a><li class="nav-list-item"><a href="/audit/vulnerability-tracking/" class="nav-list-link">Vulnerability Tracking</a><li class="nav-list-item"><a href="/audit/step-by-step-guide.html" class="nav-list-link">Step-by-Step Guide</a></ul><li class="nav-list-item"><a href="/tools/" class="nav-list-link">Tools & Scripts</a><li class="nav-list-item"><a href="/vulnerability-db/" class="nav-list-link">Vulnerability Database</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Community category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/community/" class="nav-list-link">Community</a><ul class="nav-list"><li class="nav-list-item"><a href="/community/charter.html" class="nav-list-link">Charter</a><li class="nav-list-item"><a href="/community/code-of-conduct.html" class="nav-list-link">Code of Conduct</a></ul><li class="nav-list-item"><a href="/blog/" class="nav-list-link">Blog</a><li class="nav-list-item"><a href="/news/" class="nav-list-link">Security News</a><li class="nav-list-item"><a href="/events/" class="nav-list-link">Events</a></ul><ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/orgs/ModelContextProtocol-Security/discussions" class="nav-list-link external" > GitHub Discussions <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a><li class="nav-list-item external"> <a href="https://cloudsecurityalliance.org" class="nav-list-link external" > Cloud Security Alliance <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Model Context Protocol Security" aria-label="Search Model Context Protocol Security" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/ModelContextProtocol-Security/modelcontextprotocol-security.io" class="site-button" target="_blank" rel="noopener noreferrer" > GitHub Repository </a><li class="aux-nav-list-item"> <a href="https://github.com/orgs/ModelContextProtocol-Security/discussions" class="site-button" target="_blank" rel="noopener noreferrer" > Join Discussion </a></ul></nav></div><div class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/audit/">Audit Tools</a><li class="breadcrumb-nav-list-item"><span>Tool Usage Auditing</span></ol></nav><div id="main-content" class="main-content"><main><h1 id="tool-usage-auditing"> <a href="#tool-usage-auditing" class="anchor-heading" aria-labelledby="tool-usage-auditing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Usage Auditing</h1><p><strong>Overview</strong>: Comprehensive auditing of MCP tool usage, access patterns, and security events.</p><p>Tool usage auditing provides detailed visibility into how MCP tools are being accessed, used, and managed across the system. This enables security teams to identify anomalies, ensure compliance, and maintain security posture.</p><h2 id="audit-data-collection"> <a href="#audit-data-collection" class="anchor-heading" aria-labelledby="audit-data-collection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Audit Data Collection</h2><h3 id="tool-access-logging"> <a href="#tool-access-logging" class="anchor-heading" aria-labelledby="tool-access-logging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Access Logging</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Tool access audit logging
</span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">AuditEventType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">TOOL_ACCESS</span> <span class="o">=</span> <span class="s">"tool_access"</span>
    <span class="n">TOOL_EXECUTION</span> <span class="o">=</span> <span class="s">"tool_execution"</span>
    <span class="n">TOOL_FAILURE</span> <span class="o">=</span> <span class="s">"tool_failure"</span>
    <span class="n">PERMISSION_CHANGE</span> <span class="o">=</span> <span class="s">"permission_change"</span>
    <span class="n">CONFIGURATION_CHANGE</span> <span class="o">=</span> <span class="s">"configuration_change"</span>

<span class="o">@</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">AuditEvent</span><span class="p">:</span>
    <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">AuditEventType</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">risk_level</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">compliance_tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">ToolUsageAuditor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span> <span class="o">=</span> <span class="n">AuditStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">event_processor</span> <span class="o">=</span> <span class="n">EventProcessor</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">risk_analyzer</span> <span class="o">=</span> <span class="n">RiskAnalyzer</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">compliance_checker</span> <span class="o">=</span> <span class="n">ComplianceChecker</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">log_tool_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Log tool access event with comprehensive metadata"""</span>
        
        <span class="c1"># Generate unique event ID
</span>        <span class="n">event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">generate_event_id</span><span class="p">()</span>
        
        <span class="c1"># Collect comprehensive metadata
</span>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"ip_address"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"ip_address"</span><span class="p">),</span>
            <span class="s">"user_agent"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"user_agent"</span><span class="p">),</span>
            <span class="s">"session_id"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"session_id"</span><span class="p">),</span>
            <span class="s">"request_parameters"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"parameters"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s">"authentication_method"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"auth_method"</span><span class="p">),</span>
            <span class="s">"tool_version"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"tool_version"</span><span class="p">),</span>
            <span class="s">"execution_context"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"execution_context"</span><span class="p">),</span>
            <span class="s">"resource_access"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"resource_access"</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s">"data_accessed"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"data_accessed"</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s">"network_activity"</span><span class="p">:</span> <span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"network_activity"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">}</span>
        
        <span class="c1"># Determine risk level
</span>        <span class="n">risk_level</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">risk_analyzer</span><span class="p">.</span><span class="n">assess_risk</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        
        <span class="c1"># Check compliance requirements
</span>        <span class="n">compliance_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">compliance_checker</span><span class="p">.</span><span class="n">get_compliance_tags</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        
        <span class="c1"># Create audit event
</span>        <span class="n">audit_event</span> <span class="o">=</span> <span class="n">AuditEvent</span><span class="p">(</span>
            <span class="n">event_id</span><span class="o">=</span><span class="n">event_id</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">AuditEventType</span><span class="p">.</span><span class="n">TOOL_ACCESS</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">tool_name</span><span class="o">=</span><span class="n">tool_name</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="s">"initiated"</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">risk_level</span><span class="o">=</span><span class="n">risk_level</span><span class="p">,</span>
            <span class="n">compliance_tags</span><span class="o">=</span><span class="n">compliance_tags</span>
        <span class="p">)</span>
        
        <span class="c1"># Store audit event
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">store_event</span><span class="p">(</span><span class="n">audit_event</span><span class="p">)</span>
        
        <span class="c1"># Process event for real-time analysis
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">event_processor</span><span class="p">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">audit_event</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">event_id</span>
    
    <span class="k">def</span> <span class="nf">log_tool_execution_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">execution_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="s">"""Log tool execution result and update audit event"""</span>
        
        <span class="c1"># Get original event
</span>        <span class="n">original_event</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">get_event</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">original_event</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Update execution metadata
</span>        <span class="n">execution_metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"execution_time"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"execution_time"</span><span class="p">),</span>
            <span class="s">"exit_code"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"exit_code"</span><span class="p">),</span>
            <span class="s">"output_size"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"output_size"</span><span class="p">),</span>
            <span class="s">"error_messages"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"errors"</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s">"warnings"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"warnings"</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s">"resources_consumed"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"resources_consumed"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s">"files_accessed"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"files_accessed"</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s">"network_connections"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"network_connections"</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s">"process_spawned"</span><span class="p">:</span> <span class="n">execution_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"processes_spawned"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">}</span>
        
        <span class="c1"># Create completion event
</span>        <span class="n">completion_event</span> <span class="o">=</span> <span class="n">AuditEvent</span><span class="p">(</span>
            <span class="n">event_id</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">generate_event_id</span><span class="p">(),</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">AuditEventType</span><span class="p">.</span><span class="n">TOOL_EXECUTION</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">original_event</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">tool_name</span><span class="o">=</span><span class="n">original_event</span><span class="p">.</span><span class="n">tool_name</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">original_event</span><span class="p">.</span><span class="n">action</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">original_event</span><span class="p">.</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">execution_metadata</span><span class="p">},</span>
            <span class="n">risk_level</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">risk_analyzer</span><span class="p">.</span><span class="n">assess_execution_risk</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">execution_metadata</span><span class="p">),</span>
            <span class="n">compliance_tags</span><span class="o">=</span><span class="n">original_event</span><span class="p">.</span><span class="n">compliance_tags</span>
        <span class="p">)</span>
        
        <span class="c1"># Store completion event
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">store_event</span><span class="p">(</span><span class="n">completion_event</span><span class="p">)</span>
        
        <span class="c1"># Link events
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">link_events</span><span class="p">(</span><span class="n">event_id</span><span class="p">,</span> <span class="n">completion_event</span><span class="p">.</span><span class="n">event_id</span><span class="p">)</span>
        
        <span class="c1"># Process completion event
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">event_processor</span><span class="p">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">completion_event</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_event_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Generate unique event identifier"""</span>
        
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">random_data</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}{</span><span class="n">random_data</span><span class="si">}</span><span class="s">"</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">16</span><span class="p">]</span>
</code></pre></div></div><h3 id="user-behavior-analysis"> <a href="#user-behavior-analysis" class="anchor-heading" aria-labelledby="user-behavior-analysis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User Behavior Analysis</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># User behavior analysis for auditing
</span><span class="k">class</span> <span class="nc">UserBehaviorAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">behavior_db</span> <span class="o">=</span> <span class="n">BehaviorDatabase</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pattern_detector</span> <span class="o">=</span> <span class="n">PatternDetector</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">anomaly_detector</span> <span class="o">=</span> <span class="n">AnomalyDetector</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">analyze_user_behavior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BehaviorAnalysis</span><span class="p">:</span>
        <span class="s">"""Analyze user behavior patterns for auditing"""</span>
        
        <span class="c1"># Get user's recent activity
</span>        <span class="n">recent_events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">get_user_events</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">time_window</span><span class="p">)</span>
        
        <span class="c1"># Analyze access patterns
</span>        <span class="n">access_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_access_patterns</span><span class="p">(</span><span class="n">recent_events</span><span class="p">)</span>
        
        <span class="c1"># Analyze tool usage patterns
</span>        <span class="n">tool_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_tool_usage</span><span class="p">(</span><span class="n">recent_events</span><span class="p">)</span>
        
        <span class="c1"># Analyze timing patterns
</span>        <span class="n">timing_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_timing_patterns</span><span class="p">(</span><span class="n">recent_events</span><span class="p">)</span>
        
        <span class="c1"># Detect anomalies
</span>        <span class="n">anomalies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">anomaly_detector</span><span class="p">.</span><span class="n">detect_behavioral_anomalies</span><span class="p">(</span>
            <span class="n">user_id</span><span class="p">,</span> <span class="n">recent_events</span>
        <span class="p">)</span>
        
        <span class="c1"># Calculate risk score
</span>        <span class="n">risk_score</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">calculate_behavioral_risk_score</span><span class="p">(</span>
            <span class="n">access_patterns</span><span class="p">,</span> <span class="n">tool_usage</span><span class="p">,</span> <span class="n">timing_patterns</span><span class="p">,</span> <span class="n">anomalies</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">BehaviorAnalysis</span><span class="p">(</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">analysis_period</span><span class="o">=</span><span class="n">time_window</span><span class="p">,</span>
            <span class="n">access_patterns</span><span class="o">=</span><span class="n">access_patterns</span><span class="p">,</span>
            <span class="n">tool_usage</span><span class="o">=</span><span class="n">tool_usage</span><span class="p">,</span>
            <span class="n">timing_patterns</span><span class="o">=</span><span class="n">timing_patterns</span><span class="p">,</span>
            <span class="n">anomalies</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span>
            <span class="n">risk_score</span><span class="o">=</span><span class="n">risk_score</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">analyze_access_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditEvent</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AccessPatterns</span><span class="p">:</span>
        <span class="s">"""Analyze user access patterns"""</span>
        
        <span class="c1"># Group events by source IP
</span>        <span class="n">ip_patterns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"ip_address"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip_patterns</span><span class="p">:</span>
                <span class="n">ip_patterns</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ip_patterns</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        
        <span class="c1"># Analyze geographical patterns
</span>        <span class="n">geo_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_geographical_patterns</span><span class="p">(</span><span class="n">ip_patterns</span><span class="p">)</span>
        
        <span class="c1"># Analyze device patterns
</span>        <span class="n">device_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_device_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Analyze session patterns
</span>        <span class="n">session_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_session_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">AccessPatterns</span><span class="p">(</span>
            <span class="n">ip_patterns</span><span class="o">=</span><span class="n">ip_patterns</span><span class="p">,</span>
            <span class="n">geographical_patterns</span><span class="o">=</span><span class="n">geo_patterns</span><span class="p">,</span>
            <span class="n">device_patterns</span><span class="o">=</span><span class="n">device_patterns</span><span class="p">,</span>
            <span class="n">session_patterns</span><span class="o">=</span><span class="n">session_patterns</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">analyze_tool_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditEvent</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ToolUsageAnalysis</span><span class="p">:</span>
        <span class="s">"""Analyze tool usage patterns"""</span>
        
        <span class="c1"># Group events by tool
</span>        <span class="n">tool_usage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">tool_name</span>
            <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tool_usage</span><span class="p">:</span>
                <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">"usage_count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">"success_rate"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">"average_execution_time"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">"risk_distribution"</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="s">"action_patterns"</span><span class="p">:</span> <span class="p">{}</span>
                <span class="p">}</span>
            
            <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"usage_count"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1"># Track action patterns
</span>            <span class="n">action</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">action</span>
            <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"action_patterns"</span><span class="p">]:</span>
                <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"action_patterns"</span><span class="p">][</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"action_patterns"</span><span class="p">][</span><span class="n">action</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1"># Track risk distribution
</span>            <span class="n">risk_level</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">risk_level</span>
            <span class="k">if</span> <span class="n">risk_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"risk_distribution"</span><span class="p">]:</span>
                <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"risk_distribution"</span><span class="p">][</span><span class="n">risk_level</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tool_usage</span><span class="p">[</span><span class="n">tool_name</span><span class="p">][</span><span class="s">"risk_distribution"</span><span class="p">][</span><span class="n">risk_level</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Calculate usage statistics
</span>        <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">tool_usage</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tool_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">tool_name</span> <span class="o">==</span> <span class="n">tool_name</span><span class="p">]</span>
            
            <span class="c1"># Calculate success rate
</span>            <span class="n">successful_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">tool_events</span> <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">result</span> <span class="o">==</span> <span class="s">"success"</span><span class="p">]</span>
            <span class="n">stats</span><span class="p">[</span><span class="s">"success_rate"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_events</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tool_events</span><span class="p">)</span> <span class="k">if</span> <span class="n">tool_events</span> <span class="k">else</span> <span class="mi">0</span>
            
            <span class="c1"># Calculate average execution time
</span>            <span class="n">execution_times</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">e</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"execution_time"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">tool_events</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"execution_time"</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">stats</span><span class="p">[</span><span class="s">"average_execution_time"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span> <span class="k">if</span> <span class="n">execution_times</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">ToolUsageAnalysis</span><span class="p">(</span>
            <span class="n">tool_usage_stats</span><span class="o">=</span><span class="n">tool_usage</span><span class="p">,</span>
            <span class="n">most_used_tools</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">tool_usage</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">"usage_count"</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>
            <span class="n">high_risk_activities</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">identify_high_risk_activities</span><span class="p">(</span><span class="n">tool_usage</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></div><h2 id="compliance-auditing"> <a href="#compliance-auditing" class="anchor-heading" aria-labelledby="compliance-auditing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compliance Auditing</h2><h3 id="regulatory-compliance-tracking"> <a href="#regulatory-compliance-tracking" class="anchor-heading" aria-labelledby="regulatory-compliance-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Regulatory Compliance Tracking</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compliance auditing implementation
</span><span class="k">class</span> <span class="nc">ComplianceAuditor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">compliance_rules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span> <span class="o">=</span> <span class="n">AuditStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">report_generator</span> <span class="o">=</span> <span class="n">ReportGenerator</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">setup_compliance_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Setup compliance rules for different regulations"""</span>
        
        <span class="c1"># GDPR compliance rules
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">compliance_rules</span><span class="p">[</span><span class="s">"gdpr"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"data_access_logging"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"retention_period"</span><span class="p">:</span> <span class="mi">2555</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 7 years
</span>                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Log all personal data access"</span>
            <span class="p">},</span>
            <span class="s">"consent_tracking"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Track user consent for data processing"</span>
            <span class="p">},</span>
            <span class="s">"data_portability"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Enable data export capabilities"</span>
            <span class="p">},</span>
            <span class="s">"right_to_erasure"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Support data deletion requests"</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1"># HIPAA compliance rules
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">compliance_rules</span><span class="p">[</span><span class="s">"hipaa"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"phi_access_logging"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"retention_period"</span><span class="p">:</span> <span class="mi">6</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 6 years
</span>                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Log all PHI access"</span>
            <span class="p">},</span>
            <span class="s">"minimum_necessary"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Ensure minimum necessary access"</span>
            <span class="p">},</span>
            <span class="s">"audit_controls"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Implement audit controls"</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1"># PCI DSS compliance rules
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">compliance_rules</span><span class="p">[</span><span class="s">"pci_dss"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"cardholder_data_access"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"retention_period"</span><span class="p">:</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 year
</span>                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Log cardholder data access"</span>
            <span class="p">},</span>
            <span class="s">"access_control"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Implement access controls"</span>
            <span class="p">},</span>
            <span class="s">"vulnerability_management"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Regular vulnerability assessments"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">check_compliance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regulation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComplianceReport</span><span class="p">:</span>
        <span class="s">"""Check compliance for specific regulation"""</span>
        
        <span class="k">if</span> <span class="n">regulation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">compliance_rules</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ComplianceReport</span><span class="p">(</span>
                <span class="n">regulation</span><span class="o">=</span><span class="n">regulation</span><span class="p">,</span>
                <span class="n">compliant</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s">"Unknown regulation"</span>
            <span class="p">)</span>
        
        <span class="n">rules</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">compliance_rules</span><span class="p">[</span><span class="n">regulation</span><span class="p">]</span>
        <span class="n">compliance_results</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_config</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_compliance_rule</span><span class="p">(</span><span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
            <span class="n">compliance_results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="c1"># Determine overall compliance
</span>        <span class="n">failed_rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">compliance_results</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">.</span><span class="n">compliant</span><span class="p">]</span>
        <span class="n">overall_compliant</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_rules</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">ComplianceReport</span><span class="p">(</span>
            <span class="n">regulation</span><span class="o">=</span><span class="n">regulation</span><span class="p">,</span>
            <span class="n">compliant</span><span class="o">=</span><span class="n">overall_compliant</span><span class="p">,</span>
            <span class="n">rule_results</span><span class="o">=</span><span class="n">compliance_results</span><span class="p">,</span>
            <span class="n">failed_rules</span><span class="o">=</span><span class="n">failed_rules</span><span class="p">,</span>
            <span class="n">compliance_score</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">compliance_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">compliant</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">compliance_results</span><span class="p">)</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_compliance_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rule_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComplianceRuleResult</span><span class="p">:</span>
        <span class="s">"""Check specific compliance rule"""</span>
        
        <span class="k">if</span> <span class="n">rule_name</span> <span class="o">==</span> <span class="s">"data_access_logging"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_data_access_logging</span><span class="p">(</span><span class="n">rule_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rule_name</span> <span class="o">==</span> <span class="s">"consent_tracking"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_consent_tracking</span><span class="p">(</span><span class="n">rule_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rule_name</span> <span class="o">==</span> <span class="s">"audit_controls"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_audit_controls</span><span class="p">(</span><span class="n">rule_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ComplianceRuleResult</span><span class="p">(</span>
                <span class="n">rule_name</span><span class="o">=</span><span class="n">rule_name</span><span class="p">,</span>
                <span class="n">compliant</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s">"Unknown rule"</span>
            <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_data_access_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComplianceRuleResult</span><span class="p">:</span>
        <span class="s">"""Check data access logging compliance"""</span>
        
        <span class="c1"># Get all data access events
</span>        <span class="n">data_access_events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">get_events_by_type</span><span class="p">(</span>
            <span class="n">AuditEventType</span><span class="p">.</span><span class="n">TOOL_ACCESS</span><span class="p">,</span>
            <span class="n">time_period</span>
        <span class="p">)</span>
        
        <span class="c1"># Check if all data access is logged
</span>        <span class="n">missing_logs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">data_access_events</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_data_access_properly_logged</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">missing_logs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">event_id</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">missing_logs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ComplianceRuleResult</span><span class="p">(</span>
                <span class="n">rule_name</span><span class="o">=</span><span class="s">"data_access_logging"</span><span class="p">,</span>
                <span class="n">compliant</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s">"Missing logs for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_logs</span><span class="p">)</span><span class="si">}</span><span class="s"> events"</span><span class="p">,</span>
                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s">"missing_logs"</span><span class="p">:</span> <span class="n">missing_logs</span><span class="p">}</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ComplianceRuleResult</span><span class="p">(</span>
            <span class="n">rule_name</span><span class="o">=</span><span class="s">"data_access_logging"</span><span class="p">,</span>
            <span class="n">compliant</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="s">"All data access properly logged"</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_compliance_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regulation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="s">"""Generate comprehensive compliance report"""</span>
        
        <span class="c1"># Check compliance
</span>        <span class="n">compliance_result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_compliance</span><span class="p">(</span><span class="n">regulation</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Generate detailed report
</span>        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">report_generator</span><span class="p">.</span><span class="n">generate_compliance_report</span><span class="p">(</span>
            <span class="n">regulation</span><span class="o">=</span><span class="n">regulation</span><span class="p">,</span>
            <span class="n">compliance_result</span><span class="o">=</span><span class="n">compliance_result</span><span class="p">,</span>
            <span class="n">time_period</span><span class="o">=</span><span class="n">time_period</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">report</span>
</code></pre></div></div><h2 id="audit-analytics"> <a href="#audit-analytics" class="anchor-heading" aria-labelledby="audit-analytics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Audit Analytics</h2><h3 id="advanced-audit-analytics"> <a href="#advanced-audit-analytics" class="anchor-heading" aria-labelledby="advanced-audit-analytics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Audit Analytics</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Advanced audit analytics
</span><span class="k">class</span> <span class="nc">AuditAnalytics</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">analytics_engine</span> <span class="o">=</span> <span class="n">AnalyticsEngine</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ml_analyzer</span> <span class="o">=</span> <span class="n">MLAnalyzer</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">visualization_engine</span> <span class="o">=</span> <span class="n">VisualizationEngine</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">perform_risk_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RiskAnalysisReport</span><span class="p">:</span>
        <span class="s">"""Perform comprehensive risk analysis"""</span>
        
        <span class="c1"># Get audit events
</span>        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Analyze risk patterns
</span>        <span class="n">risk_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_risk_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Identify high-risk users
</span>        <span class="n">high_risk_users</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">identify_high_risk_users</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Analyze tool risk distribution
</span>        <span class="n">tool_risk_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">analyze_tool_risk_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Detect risk trends
</span>        <span class="n">risk_trends</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">detect_risk_trends</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">RiskAnalysisReport</span><span class="p">(</span>
            <span class="n">analysis_period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span>
            <span class="n">risk_patterns</span><span class="o">=</span><span class="n">risk_patterns</span><span class="p">,</span>
            <span class="n">high_risk_users</span><span class="o">=</span><span class="n">high_risk_users</span><span class="p">,</span>
            <span class="n">tool_risk_analysis</span><span class="o">=</span><span class="n">tool_risk_analysis</span><span class="p">,</span>
            <span class="n">risk_trends</span><span class="o">=</span><span class="n">risk_trends</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">detect_anomalies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnomalyDetectionReport</span><span class="p">:</span>
        <span class="s">"""Detect anomalies in audit data"""</span>
        
        <span class="c1"># Get audit events
</span>        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">audit_store</span><span class="p">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Statistical anomaly detection
</span>        <span class="n">statistical_anomalies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ml_analyzer</span><span class="p">.</span><span class="n">detect_statistical_anomalies</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Behavioral anomaly detection
</span>        <span class="n">behavioral_anomalies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ml_analyzer</span><span class="p">.</span><span class="n">detect_behavioral_anomalies</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Temporal anomaly detection
</span>        <span class="n">temporal_anomalies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ml_analyzer</span><span class="p">.</span><span class="n">detect_temporal_anomalies</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># Network anomaly detection
</span>        <span class="n">network_anomalies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ml_analyzer</span><span class="p">.</span><span class="n">detect_network_anomalies</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">AnomalyDetectionReport</span><span class="p">(</span>
            <span class="n">analysis_period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span>
            <span class="n">statistical_anomalies</span><span class="o">=</span><span class="n">statistical_anomalies</span><span class="p">,</span>
            <span class="n">behavioral_anomalies</span><span class="o">=</span><span class="n">behavioral_anomalies</span><span class="p">,</span>
            <span class="n">temporal_anomalies</span><span class="o">=</span><span class="n">temporal_anomalies</span><span class="p">,</span>
            <span class="n">network_anomalies</span><span class="o">=</span><span class="n">network_anomalies</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_audit_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="s">"""Generate comprehensive audit dashboard"""</span>
        
        <span class="c1"># Get key metrics
</span>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">calculate_audit_metrics</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Generate visualizations
</span>        <span class="n">visualizations</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">visualization_engine</span><span class="p">.</span><span class="n">generate_audit_visualizations</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Get recent alerts
</span>        <span class="n">recent_alerts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_recent_audit_alerts</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Get compliance status
</span>        <span class="n">compliance_status</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_compliance_status</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">"metrics"</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="s">"visualizations"</span><span class="p">:</span> <span class="n">visualizations</span><span class="p">,</span>
            <span class="s">"recent_alerts"</span><span class="p">:</span> <span class="n">recent_alerts</span><span class="p">,</span>
            <span class="s">"compliance_status"</span><span class="p">:</span> <span class="n">compliance_status</span><span class="p">,</span>
            <span class="s">"last_updated"</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div><h2 id="audit-reporting"> <a href="#audit-reporting" class="anchor-heading" aria-labelledby="audit-reporting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Audit Reporting</h2><h3 id="comprehensive-audit-reports"> <a href="#comprehensive-audit-reports" class="anchor-heading" aria-labelledby="comprehensive-audit-reports"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Comprehensive Audit Reports</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Audit reporting system
</span><span class="k">class</span> <span class="nc">AuditReportGenerator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">template_engine</span> <span class="o">=</span> <span class="n">TemplateEngine</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span> <span class="o">=</span> <span class="n">DataAggregator</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">chart_generator</span> <span class="o">=</span> <span class="n">ChartGenerator</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">generate_executive_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutiveSummary</span><span class="p">:</span>
        <span class="s">"""Generate executive summary of audit findings"""</span>
        
        <span class="c1"># Aggregate key metrics
</span>        <span class="n">total_events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">count_events</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">high_risk_events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">count_high_risk_events</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">compliance_score</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">calculate_compliance_score</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Identify top issues
</span>        <span class="n">top_issues</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">get_top_security_issues</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Calculate trends
</span>        <span class="n">trend_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">analyze_trends</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ExecutiveSummary</span><span class="p">(</span>
            <span class="n">reporting_period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span>
            <span class="n">total_events</span><span class="o">=</span><span class="n">total_events</span><span class="p">,</span>
            <span class="n">high_risk_events</span><span class="o">=</span><span class="n">high_risk_events</span><span class="p">,</span>
            <span class="n">compliance_score</span><span class="o">=</span><span class="n">compliance_score</span><span class="p">,</span>
            <span class="n">top_issues</span><span class="o">=</span><span class="n">top_issues</span><span class="p">,</span>
            <span class="n">trend_analysis</span><span class="o">=</span><span class="n">trend_analysis</span><span class="p">,</span>
            <span class="n">recommendations</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">generate_recommendations</span><span class="p">(</span><span class="n">top_issues</span><span class="p">,</span> <span class="n">trend_analysis</span><span class="p">)</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_detailed_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DetailedAuditReport</span><span class="p">:</span>
        <span class="s">"""Generate detailed audit report"""</span>
        
        <span class="c1"># Executive summary
</span>        <span class="n">executive_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">generate_executive_summary</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Detailed findings
</span>        <span class="n">detailed_findings</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">get_detailed_findings</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># User activity analysis
</span>        <span class="n">user_activity</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">analyze_user_activity</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Tool usage analysis
</span>        <span class="n">tool_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">analyze_tool_usage</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Risk analysis
</span>        <span class="n">risk_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">perform_risk_analysis</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="c1"># Compliance analysis
</span>        <span class="n">compliance_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_aggregator</span><span class="p">.</span><span class="n">analyze_compliance</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">DetailedAuditReport</span><span class="p">(</span>
            <span class="n">executive_summary</span><span class="o">=</span><span class="n">executive_summary</span><span class="p">,</span>
            <span class="n">detailed_findings</span><span class="o">=</span><span class="n">detailed_findings</span><span class="p">,</span>
            <span class="n">user_activity</span><span class="o">=</span><span class="n">user_activity</span><span class="p">,</span>
            <span class="n">tool_usage</span><span class="o">=</span><span class="n">tool_usage</span><span class="p">,</span>
            <span class="n">risk_analysis</span><span class="o">=</span><span class="n">risk_analysis</span><span class="p">,</span>
            <span class="n">compliance_analysis</span><span class="o">=</span><span class="n">compliance_analysis</span><span class="p">,</span>
            <span class="n">charts</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">chart_generator</span><span class="p">.</span><span class="n">generate_audit_charts</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></div><h2 id="best-practices"> <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices</h2><h3 id="audit-implementation-guidelines"> <a href="#audit-implementation-guidelines" class="anchor-heading" aria-labelledby="audit-implementation-guidelines"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Audit Implementation Guidelines</h3><ol><li><strong>Comprehensive Logging</strong>: Log all tool access and usage events<li><strong>Real-time Analysis</strong>: Implement real-time audit event processing<li><strong>Compliance Integration</strong>: Integrate regulatory compliance requirements<li><strong>Anomaly Detection</strong>: Use ML-based anomaly detection<li><strong>Regular Reporting</strong>: Generate regular audit reports and dashboards<li><strong>Data Retention</strong>: Implement appropriate data retention policies<li><strong>Privacy Protection</strong>: Protect sensitive audit data<li><strong>Access Controls</strong>: Implement strict access controls for audit data</ol><h3 id="common-audit-challenges"> <a href="#common-audit-challenges" class="anchor-heading" aria-labelledby="common-audit-challenges"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common Audit Challenges</h3><ul><li><strong>Data Volume</strong>: Managing large volumes of audit data<li><strong>Performance Impact</strong>: Minimizing performance impact of logging<li><strong>Data Privacy</strong>: Balancing audit requirements with privacy<li><strong>False Positives</strong>: Reducing false positive alerts<li><strong>Compliance Complexity</strong>: Managing multiple compliance requirements<li><strong>Real-time Processing</strong>: Processing audit events in real-time</ul><hr /><p><em>Tool Usage Auditing provides comprehensive visibility into MCP tool usage patterns, enabling effective security monitoring, compliance management, and risk assessment.</em></p></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">This project is sponsored by the <a href="https://cloudsecurityalliance.org">Cloud Security Alliance</a> and maintained by the Model Context Protocol Security Working Group.</p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div>
